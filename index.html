



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://pages.charlesreid1.com/d-gitea/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href=".">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-3.0.3">
    
    
      
        <title>d-gitea</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#7cb342">
      
    
    
      <script src="assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="css/custom.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="light-green" data-md-color-accent="light-green">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#d-gitea" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://pages.charlesreid1.com/d-gitea" title="d-gitea" class="md-header-nav__button md-logo">
          
            <i class="md-icon">input</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                d-gitea
              </span>
              <span class="md-header-nav__topic">
                Home
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://git.charlesreid1.com/docker/d-gitea" title="Go to repository" class="md-source" data-md-source="">
    
    <div class="md-source__repository">
      d-gitea
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://pages.charlesreid1.com/d-gitea" title="d-gitea" class="md-nav__button md-logo">
      
        <i class="md-icon">input</i>
      
    </a>
    d-gitea
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://git.charlesreid1.com/docker/d-gitea" title="Go to repository" class="md-source" data-md-source="">
    
    <div class="md-source__repository">
      d-gitea
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Home
      </label>
    
    <a href="." title="Home" class="md-nav__link md-nav__link--active">
      Home
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" title="Table of Contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secrets" title="Secrets" class="md-nav__link">
    Secrets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jinja-templates" title="Jinja Templates" class="md-nav__link">
    Jinja Templates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-directory-structure" title="Container Directory Structure" class="md-nav__link">
    Container Directory Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-data-volume" title="Container Data Volume" class="md-nav__link">
    Container Data Volume
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#git-repositories" title="Git Repositories" class="md-nav__link">
    Git Repositories
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure-before-adding-repos-to-gitea" title="directory structure before adding repos to gitea" class="md-nav__link">
    directory structure before adding repos to gitea
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directory-structure-after-adding-repos-to-gitea" title="directory structure after adding repos to gitea" class="md-nav__link">
    directory structure after adding repos to gitea
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backing-up-git-repositories" title="Backing up git repositories" class="md-nav__link">
    Backing up git repositories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files-mounted-into-container" title="Files Mounted Into Container" class="md-nav__link">
    Files Mounted Into Container
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-docker-composeyml-file" title="Using the docker-compose.yml File" class="md-nav__link">
    Using the docker-compose.yml File
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standalone" title="Standalone" class="md-nav__link">
    Standalone
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod-charlesreid1" title="pod-charlesreid1" class="md-nav__link">
    pod-charlesreid1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes-on-custom-files" title="Notes on Custom Files" class="md-nav__link">
    Notes on Custom Files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-templates-directory" title="custom templates directory" class="md-nav__link">
    custom templates directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-gitea-pages" title="custom gitea pages" class="md-nav__link">
    custom gitea pages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backing-up-and-restoring-gitea" title="Backing up and restoring gitea" class="md-nav__link">
    Backing up and restoring gitea
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-backup" title="Creating a Backup" class="md-nav__link">
    Creating a Backup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contents-of-dump-file" title="Contents of Dump File" class="md-nav__link">
    Contents of Dump File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restoring-a-backup" title="Restoring a Backup" class="md-nav__link">
    Restoring a Backup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restoring-repositories-directory" title="Restoring repositories directory" class="md-nav__link">
    Restoring repositories directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-backups" title="Database backups" class="md-nav__link">
    Database backups
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" title="Table of Contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secrets" title="Secrets" class="md-nav__link">
    Secrets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jinja-templates" title="Jinja Templates" class="md-nav__link">
    Jinja Templates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-directory-structure" title="Container Directory Structure" class="md-nav__link">
    Container Directory Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-data-volume" title="Container Data Volume" class="md-nav__link">
    Container Data Volume
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#git-repositories" title="Git Repositories" class="md-nav__link">
    Git Repositories
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure-before-adding-repos-to-gitea" title="directory structure before adding repos to gitea" class="md-nav__link">
    directory structure before adding repos to gitea
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directory-structure-after-adding-repos-to-gitea" title="directory structure after adding repos to gitea" class="md-nav__link">
    directory structure after adding repos to gitea
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backing-up-git-repositories" title="Backing up git repositories" class="md-nav__link">
    Backing up git repositories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files-mounted-into-container" title="Files Mounted Into Container" class="md-nav__link">
    Files Mounted Into Container
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-docker-composeyml-file" title="Using the docker-compose.yml File" class="md-nav__link">
    Using the docker-compose.yml File
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standalone" title="Standalone" class="md-nav__link">
    Standalone
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod-charlesreid1" title="pod-charlesreid1" class="md-nav__link">
    pod-charlesreid1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes-on-custom-files" title="Notes on Custom Files" class="md-nav__link">
    Notes on Custom Files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-templates-directory" title="custom templates directory" class="md-nav__link">
    custom templates directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-gitea-pages" title="custom gitea pages" class="md-nav__link">
    custom gitea pages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backing-up-and-restoring-gitea" title="Backing up and restoring gitea" class="md-nav__link">
    Backing up and restoring gitea
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-backup" title="Creating a Backup" class="md-nav__link">
    Creating a Backup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contents-of-dump-file" title="Contents of Dump File" class="md-nav__link">
    Contents of Dump File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restoring-a-backup" title="Restoring a Backup" class="md-nav__link">
    Restoring a Backup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restoring-repositories-directory" title="Restoring repositories directory" class="md-nav__link">
    Restoring repositories directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-backups" title="Database backups" class="md-nav__link">
    Database backups
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="d-gitea">d-gitea<a class="headerlink" href="#d-gitea" title="Permanent link">&para;</a></h1>
<p>Docker files for running gitea</p>
<p><a href="https://pages.charlesreid1.com/d-gitea/">documentation: d-gitea container</a> (you are here)</p>
<p><a href="https://git.charlesreid1.com/docker/d-gitea">source code on git.charlesreid1.com: d-gitea</a></p>
<p><a href="https://github.com/charlesreid1-docker/d-gitea">source code on github.com: charlesreid1-docker/d-gitea</a></p>
<p><a href="https://docs.gitea.io/en-us/install-with-docker/">gitea documentation - running gitea with docker</a></p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li>secrets</li>
<li>app.ini file</li>
<li>jinja templates</li>
<li>container directory structure</li>
<li>container data volume</li>
<li>git repositories</li>
<li>files mounted into container</li>
<li>using the <code>docker-compose.yml</code> file</li>
<li>notes on custom files</li>
<li>configuring gitea with <code>app.ini</code></li>
<li>customizing gitea with custom files</li>
<li>backing up and restoring gitea</li>
</ul>
<h2 id="secrets">Secrets<a class="headerlink" href="#secrets" title="Permanent link">&para;</a></h2>
<p>There are two secrets that must be set in the Gitea configuration file:
the internal token and the secret key.</p>
<p>The two secret values can be placed in two <code>*.secret</code> files:</p>
<div class="codehilite"><pre><span></span>internal_token.secret
secret_key.secret
</pre></div>


<p>The contents should be the value of the secret variable 
you wish to use in <code>custom/conf/app.ini</code>.</p>
<p>These files are not tracked by git.</p>
<h2 id="jinja-templates">Jinja Templates<a class="headerlink" href="#jinja-templates" title="Permanent link">&para;</a></h2>
<p>The <code>app.ini</code> script is not stored directly in this repo, since it contains
sensitive information. Instead, we store a Jinja template, <code>app.ini.j2</code>, which
is rendered into a real <code>app.ini</code> file after variable substitutions, etc.</p>
<p>Normally, we use this repo with Ansible, so we don't deal with the Jinja template
ourselves.</p>
<p>If you want to render the Jinja template into a real config file without using
Ansible, use the <code>make_app_ini.sh</code> script:</p>
<div class="codehilite"><pre><span></span>$ ./make_app_ini.sh
</pre></div>


<p>(This requires the two secret files mentioned above to be present.)</p>
<h2 id="container-directory-structure">Container Directory Structure<a class="headerlink" href="#container-directory-structure" title="Permanent link">&para;</a></h2>
<p>The <code>custom/</code> dir in this folder maps to the <code>/data/gitea</code> volume
inside the gitea container.</p>
<p>For example, the <code>app.ini</code> configuration file will be mapped into 
the container at <code>/data/gitea/conf/app.ini</code>.</p>
<h2 id="container-data-volume">Container Data Volume<a class="headerlink" href="#container-data-volume" title="Permanent link">&para;</a></h2>
<p>This container expects to use a docker data volume 
to store the gitea custom configuration 
and the entire contents of all repositories.</p>
<p>On the host machine, you can access named data volumes at 
<code>/var/lib/docker/volumes/gitea_gitea/_data</code>
or copy files in and out of the container using <code>docker cp</code>.</p>
<h2 id="git-repositories">Git Repositories<a class="headerlink" href="#git-repositories" title="Permanent link">&para;</a></h2>
<h3 id="directory-structure-before-adding-repos-to-gitea">directory structure before adding repos to gitea<a class="headerlink" href="#directory-structure-before-adding-repos-to-gitea" title="Permanent link">&para;</a></h3>
<p>Directory structure for host-mounted gitea directory
before any repositories have been added to gitea:</p>
<div class="codehilite"><pre><span></span>gitea
├── git
│   └── repositories
├── gitea
│   ├── conf
│   │   └── app.ini
│   ├── gitea.db
│   ├── indexers
│   │   └── issues.bleve
│   │       ├── index_meta.json
│   │       └── store
│   ├── lfs
│   ├── log
│   │   ├── gitea.log
│   │   ├── http.log
│   │   └── xorm.log
│   └── sessions
│       └── oauth2
└── ssh [error opening dir]

11 directories, 7 files
</pre></div>


<h3 id="directory-structure-after-adding-repos-to-gitea">directory structure after adding repos to gitea<a class="headerlink" href="#directory-structure-after-adding-repos-to-gitea" title="Permanent link">&para;</a></h3>
<p>After adding a repository:</p>
<div class="codehilite"><pre><span></span>gitea
├── git
│   └── repositories
│       └─e charlesreid1
│           └── oieruoweiur.git
│               ├── branches
│               ├── config
│               ├── description
│               ├── HEAD
│               ├── hooks
│               │   ├── applypatch-msg.sample
│               │   ├── commit-msg.sample
│               │   ├── post-receive
│               │   ├── post-receive.d
│               │   │   └── gitea
│               │   ├── post-update.sample
│               │   ├── pre-applypatch.sample
│               │   ├── pre-commit.sample
│               │   ├── prepare-commit-msg.sample
│               │   ├── pre-push.sample
│               │   ├── pre-rebase.sample
│               │   ├── pre-receive
│               │   ├── pre-receive.d
│               │   │   └── gitea
│               │   ├── pre-receive.sample
│               │   ├── update
│               │   ├── update.d
│               │   │   └── gitea
│               │   └── update.sample
│               ├── info
│               │   ├── exclude
│               │   └── refs
│               ├── objects
│               │   ├── info
│               │   │   └── packs
│               │   └── pack
│               └── refs
│                   ├── heads
│                   └── tags
├── gitea
│   ├── conf
│   │   └── app.ini
│   ├── gitea.db
│   ├── indexers
│   │   └── issues.bleve
│   │       ├── index_meta.json
│   │       └── store
│   ├── lfs
│   ├── log
│   │   ├── gitea.log
│   │   ├── http.log
│   │   └── xorm.log
│   └── sessions
│       └── oauth2
└── ssh [error opening dir]

25 directories, 29 files
</pre></div>


<h3 id="backing-up-git-repositories">Backing up git repositories<a class="headerlink" href="#backing-up-git-repositories" title="Permanent link">&para;</a></h3>
<p>Backing up git repositories associated with the gitea instance
is a separate step from gitea dump (see above).</p>
<p>Before backing up repositories, perform a gitea dump without the
repositories included.</p>
<p>All git repositories are stored in <code>/data/git/repositories/</code>. They are stored
in the subdirectory <code>org-name/repo-name</code>.</p>
<p>To back up all repositories, copy the folder <code>/data/git/repositories</code> from the
gitea container.</p>
<p>To restore all repositories, copy the folder <code>/data/git/repositories</code> into the
gitea container.</p>
<h2 id="files-mounted-into-container">Files Mounted Into Container<a class="headerlink" href="#files-mounted-into-container" title="Permanent link">&para;</a></h2>
<p>The <code>d-gitea/custom/</code> directory is mounted into the container at <code>/data/gitea</code>.</p>
<p>The <code>d-gitea/data/</code> directory is mounted into the container at <code>/app/gitea/data</code>.</p>
<p>To make the custom configuration file, follow the instructions mentioned in
the "Secrets" section.</p>
<h2 id="using-the-docker-composeyml-file">Using the <code>docker-compose.yml</code> File<a class="headerlink" href="#using-the-docker-composeyml-file" title="Permanent link">&para;</a></h2>
<h3 id="standalone">Standalone<a class="headerlink" href="#standalone" title="Permanent link">&para;</a></h3>
<p>This directory contains a docker-compose file that can be used to run 
a gitea server on port 3000.</p>
<p>To get the gitea container up and running, </p>
<div class="codehilite"><pre><span></span>$ docker-compose up
</pre></div>


<p>Now visit <code>&lt;server-ip&gt;:3000</code>. You will be presented with a configuration page.
Set up the gitea instance. This will automatically populate the directory 
structure. See below for more info.</p>
<p>Use this as a project seed to add gitea containers to other docker pods.</p>
<h3 id="pod-charlesreid1">pod-charlesreid1<a class="headerlink" href="#pod-charlesreid1" title="Permanent link">&para;</a></h3>
<p>The main use of this repo is as a submodule in
<a href="https://github.com/charlesreid1-docker/pod-charlesreid1.git">pod-charlesreid1</a>.</p>
<p>This pod is set up by Ansible, which integrates well with the Jinja template approach.</p>
<h2 id="notes-on-custom-files">Notes on Custom Files<a class="headerlink" href="#notes-on-custom-files" title="Permanent link">&para;</a></h2>
<p>The settings in the <code>app.ini</code> file are documented <a href="https://docs.gitea.io/en-us/config-cheat-sheet/">here</a>.</p>
<p>An extensive sample <code>app.ini</code> file is <a href="https://github.com/go-gitea/gitea/blob/master/custom/conf/app.ini.sample">here</a> (WARNING: this broke gitea).</p>
<p>The existing gitea templates are in the gitea repo under <a href="https://github.com/go-gitea/gitea/tree/master/templates">templates/</a>.
These can be modified as needed and placed in the <code>custom/templates/</code> directory.</p>
<h3 id="custom-templates-directory">custom templates directory<a class="headerlink" href="#custom-templates-directory" title="Permanent link">&para;</a></h3>
<p>The templates directory <code>d-gitea/custom/templates</code> contains template files. 
These are gitea templates that control how particular kinds of gitea pages look.
For example, a template can be used to modify how the user page looks, or modify
the layout of repository main pages.</p>
<p>In the container, this will be at <code>/data/gitea/templates/</code>.</p>
<h3 id="custom-gitea-pages">custom gitea pages<a class="headerlink" href="#custom-gitea-pages" title="Permanent link">&para;</a></h3>
<p>The custom pages directory <code>d-gitea/custom/pages</code> contains one-off pages or static
content that is hosted by the gitea instance, but not necessarily incorporated into
the gitea site.</p>
<p>For example, a custom "about me" page could be added as a static .html file,
and it would be hosted at <code>git.charlesreid1.com/about</code>.</p>
<p>In the container, this will be at <code>/data/gitea/pages/</code>.</p>
<h2 id="backing-up-and-restoring-gitea">Backing up and restoring gitea<a class="headerlink" href="#backing-up-and-restoring-gitea" title="Permanent link">&para;</a></h2>
<p>Running <code>gitea dump</code> command will dump files required for restoring an existing
Gitea instance. Unfortunately, gitea's backup and restore functionality is an
absolute dumpster fire.</p>
<p>We do our best to walk through the process, but here is a summary:
* On the old system:
    * Create a backup file <code>gitea-dump.zip</code> using the very specific <code>gitea dump</code> incantation that works
    * Move the backup file out of the gitea container
* On the new system:
    * Unzip the backup file <code>gitea-dump.zip</code>
    * Put appropriate files in appropriate location
    * Use the table below to determine where in the repo the gitea dump files should go,
      and where they will be available inside the gitea container</p>
<h3 id="creating-a-backup">Creating a Backup<a class="headerlink" href="#creating-a-backup" title="Permanent link">&para;</a></h3>
<p>To create a gitea dump, connect to the docker container and get a bash shell as the user
<code>git</code> via the docker exec command:</p>
<div class="codehilite"><pre><span></span># connect to gitea container
docker exec -it --user git name_of_gitea_container /bin/bash
</pre></div>


<p>This will give you a bash shell as the user <code>git</code>. Now create a gitea dump file
(the gitea dump command requires you to be in <code>/app/gitea</code>, this assumes that the
gitea executable is at the default location of <code>/app/gitea/gitea</code>):</p>
<div class="codehilite"><pre><span></span># necessary
cd /app/gitea
# create gitea dump
/app/gitea/gitea dump --file gitea-dump.zip --skip-repository
</pre></div>


<p><strong>IMPORTANT: The <code>--skip-repositories</code> flag means we are making the gitea dump
way, way, way smaller, but it also means we need to back up and restore the
repositories folder ourselves! (See below for instructions.)</strong></p>
<p>Now copy the file out of the container, then remove it from the container:</p>
<div class="codehilite"><pre><span></span># copy gitea dump out of container
docker cp name_of_gitea_container:/app/gitea/gitea-dump.zip .

# remove gitea dump
docker exec -it name_of_gitea_container rm /app/gitea/gitea-dump.zip
</pre></div>


<h3 id="contents-of-dump-file">Contents of Dump File<a class="headerlink" href="#contents-of-dump-file" title="Permanent link">&para;</a></h3>
<p>When the gitea dump file is unzipped, it will create the following files:</p>
<ul>
<li><code>app.ini</code></li>
<li><code>custom/</code> directory</li>
<li><code>log/</code> directory (useless duplicate, already contained in <code>custom/</code> dir)</li>
<li><code>data/</code> directory</li>
</ul>
<p>These files should map to the following locations in the docker container
running the live gitea instance:</p>
<div class="codehilite"><pre><span></span>gitea dump file:        gitea live instance:
----------------        --------------------
app.ini                 /data/gitea/conf/app.ini
custom/                 /data/gitea/
log/                    (useless duplicate of custom/log/)
data                    /app/gitea/data
</pre></div>


<h3 id="restoring-a-backup">Restoring a Backup<a class="headerlink" href="#restoring-a-backup" title="Permanent link">&para;</a></h3>
<p>To restore a backup, copy the following files from the gitea dump
to the following locations inside this repository:</p>
<div class="codehilite"><pre><span></span>gitea dump file:        d-gitea repo location:
----------------        ----------------------
app.ini                 d-gitea/custom/conf/app.ini
custom/*                d-gitea/custom/*
data                    d-gitea/data
</pre></div>


<p>(If you're running pod-charlesreid1, put these files in the
specified location in the <code>d-gitea</code> submodule.)</p>
<h3 id="restoring-repositories-directory">Restoring repositories directory<a class="headerlink" href="#restoring-repositories-directory" title="Permanent link">&para;</a></h3>
<p>Note that when we created the gitea dump, we excluded the repositories themselves.
This is because these will greatly inflate the size of our gitea dump and will make
it much more difficult to store our backup files.</p>
<p>Repository contents can be backed up separately as follows:</p>
<ul>
<li>Log in to the old server</li>
<li>Back up the <code>/data/git/repositories</code> directory (copy and compress)</li>
<li>Copy the backup to the new server</li>
<li>Log in to the new server</li>
<li>Mount the <code>/data/git/repositories</code> folder</li>
</ul>
<p>Optionally, if you want to keep the repositories folder in its own location,
modify <code>docker-compose.yml</code> to add the following line to the <code>gitea</code> container's
<code>volumes</code> configuration:</p>
<div class="codehilite"><pre><span></span>services:
  server:
    image: gitea/gitea:latest

    ...

    volumes:
      - &quot;/path/to/repositories:/data/git/repositories&quot;

    ...
</pre></div>


<p>This should make it easier to manage, back up, and restore the repositories folder.</p>
<h3 id="database-backups">Database backups<a class="headerlink" href="#database-backups" title="Permanent link">&para;</a></h3>
<p>We opt for the SQLite backend for gitea, which means the database
is kept in a flat file on disk called <code>/data/gitea/gitea.db</code>.</p>
<p>The location of this file and the format of the database are specified
in the config file in <code>d-gitea/custom/conf/app.ini</code>.</p>
<p>This file should not be edited, instead change the Jinja template
<code>d-gitea/custom/conf/app.ini.j2</code> and remake <code>app.ini</code> from the template.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 <a href="https://charlesreid1.com">Charles Reid</a>, released under the <a href="https://opensource.org/licenses/MIT">MIT license</a>
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.e72fd936.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"."}})</script>
      
        <script src="search/main.js"></script>
      
    
    
      
    
  </body>
</html>